<!doctype html>
<html lang="el">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Thronos Driver Platform</title>
    <link rel="icon" href="https://thronoschain.org/thronos-coin.png" />
    <link rel="stylesheet" href="/style.css" />
  </head>
  <body>
    <div class="app-shell">
      <div class="card">
        <div class="card-title">Thronos Driver Platform</div>
        <p class="small-text">Fleet telemetry, σχολές οδήγησης, voice dispatch και rewards.</p>
        <div class="row">
          <a class="primary full" href="/app">Δοκιμή Taxi Fleet</a>
          <a class="outline full" href="/school">Δοκιμή Σχολή</a>
          <a class="outline full" href="/operator">Operator Login</a>
        </div>
        <button class="primary full" id="btnOpenTrial" style="margin-top:10px;">Ξεκίνα 14ήμερο Trial</button>
      </div>

      <div id="trialModal" class="card" style="display:none;">
        <div class="card-header"><div class="card-title">Δημιουργία Trial Φορέα</div><button class="outline" id="btnCloseTrial">Κλείσιμο</button></div>
        <div class="field-group"><label for="trialCompany">Company name</label><input id="trialCompany" placeholder="π.χ. Taxiway" /></div>
        <div class="field-group"><label for="trialEmail">Contact email</label><input id="trialEmail" placeholder="ops@example.com" /></div>
        <div class="field-group"><label for="trialPhone">Phone (optional)</label><input id="trialPhone" placeholder="69XXXXXXXX" /></div>
        <button class="primary full" id="btnCreateTrial">Create trial</button>
        <div id="trialMessage" class="small-text"></div>
      </div>

      <div class="card">
        <div class="card-title">Use cases</div>
        <ul>
          <li>Taxi/Μεταφορικές στόλοι με live map και approvals οδηγών.</li>
          <li>Driving schools με operator dashboard.</li>
          <li>Transport teams με OTP login και voice μηνύματα.</li>
        </ul>
      </div>

      <div class="card">
        <div class="card-title">Pricing</div>
        <div id="plansHost" class="small-text">Loading plans…</div>
      </div>
    </div>

    <script>
      async function loadPlans() {
        try {
          const r = await fetch('/api/plans');
          const data = await r.json();
          const plans = data.plans || {};
          const html = Object.entries(plans).map(([k, v]) => `
            <div style="margin-bottom:10px;">
              <strong>${k.toUpperCase()}</strong> — ${(v.features || []).join(', ')}
            </div>`).join('');
          document.getElementById('plansHost').innerHTML = html || 'No plans';
        } catch (_) {
          document.getElementById('plansHost').textContent = 'Plans unavailable';
        }
      }

      async function createTrial() {
        const payload = {
          company_name: document.getElementById('trialCompany').value.trim(),
          contact_email: document.getElementById('trialEmail').value.trim(),
          phone: document.getElementById('trialPhone').value.trim() || null,
          type: 'taxi'
        };
        const msg = document.getElementById('trialMessage');
        const resp = await fetch('/api/trials/create', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload)
        });
        const data = await resp.json().catch(() => ({}));
        if (!resp.ok) {
          msg.textContent = data.detail || 'Trial creation failed';
          return;
        }
        msg.textContent = `Ο φορέας σου δημιουργήθηκε: ${payload.company_name} (group: ${data.group_tag})`;
      }

      document.getElementById('btnOpenTrial').onclick = () => document.getElementById('trialModal').style.display = 'block';
      document.getElementById('btnCloseTrial').onclick = () => document.getElementById('trialModal').style.display = 'none';
      document.getElementById('btnCreateTrial').onclick = createTrial;
      loadPlans();
    </script>
  </body>
</html>
